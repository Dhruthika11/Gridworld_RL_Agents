<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced RL Gridworld Comparison</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>‚ö° Advanced RL Gridworld Comparison</h1>
            <p class="subtitle">Compare Q-Learning, SARSA, and Naive Policies in Real-Time</p>
        </header>

        <!-- HYPERPARAMETERS CONTROL PANEL -->
        <div class="hyperparameters-section">
            <h2>Hyperparameters Control</h2>
            <div class="params-grid">
                <!-- Hyperparameters Control, inside .params-grid -->
                <div class="param-item">
                    <label for="grid-size">Grid Size:</label>
                    <input type="range" id="grid-size" min="3" max="15" value="4">
                    <span class="param-value" id="grid-size-value">4x4</span>
                </div>

                <div class="param-item">
                    <label for="learning-rate">Learning Rate (Œ±):</label>
                    <input type="range" id="learning-rate" min="0.01" max="1" step="0.01" value="0.1">
                    <span class="param-value" id="learning-rate-value">0.10</span>
                </div>
                <div class="param-item">
                    <label for="discount-factor">Discount Factor (Œ≥):</label>
                    <input type="range" id="discount-factor" min="0" max="1" step="0.05" value="0.9">
                    <span class="param-value" id="discount-factor-value">0.90</span>
                </div>
                <div class="param-item">
                    <label for="exploration-decay">Exploration Decay:</label>
                    <input type="range" id="exploration-decay" min="0.00001" max="0.005" step="0.00001" value="0.0005">
                    <input type="number" id="exploration-decay-number" min="0.00001" max="0.005" step="0.00001" value="0.0005">
                    <span class="param-value" id="exploration-decay-value">0.0005</span>
                </div>

                <div class="param-item">
                    <label for="min-exploration">Min Exploration (Œµ):</label>
                    <input type="range" id="min-exploration" min="0.001" max="0.1" step="0.001" value="0.01">
                    <span class="param-value" id="min-exploration-value">0.010</span>
                </div>
            </div>
        </div>

        <!-- üï≥Ô∏è HOLE SELECTOR SECTION -->
        <div class="hole-selector-section">
            <h2>üï≥Ô∏è Configure Holes</h2>
            <p class="hole-info">Click cells to add/remove holes. Start (S) and Goal (G) cannot be holes.</p>
            <div id="hole-grid-container"></div>
            <div class="hole-actions">
                <button id="clear-holes-btn" class="btn-secondary btn--sm">Clear All Holes</button>
                <button id="reset-holes-btn" class="btn-secondary btn--sm">Reset to Default</button>
                <span class="hole-count">Holes: <strong id="hole-count">0</strong></span>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="card">
                <h2>Training Status</h2>
                <div class="stat-row">
                    <span class="stat-label">Episodes:</span>
                    <span class="stat-value" id="episode-count">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Exploration Rate (Œµ):</span>
                    <span class="stat-value" id="epsilon-display">1.000</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Training Time:</span>
                    <span class="stat-value" id="training-time">0s</span>
                </div>
                <div class="control-section">
                    <div class="input-group">
                        <label>Training Mode:</label>
                        <select id="training-mode" class="form-control">
                            <option value="batch">Batch</option>
                            <option value="max">To Max</option>
                        </select>
                        <label>Episodes/Step:</label>
                        <input type="number" id="episodes-input" value="200" min="1" max="2000">
                    </div>
                    <div class="button-group">
                        <button id="start-btn" class="btn-primary">‚ñ∂ Start Training</button>
                        <button id="reset-btn" class="btn-secondary">‚Üª Reset</button>
                    </div>
                </div>

            </div>

            <div class="card">
                <h2>Performance Metrics</h2>
                <div class="stat-row">
                    <span class="stat-label">Q-Learning Avg:</span>
                    <span class="stat-value" id="q-avg">0.00</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">SARSA Avg:</span>
                    <span class="stat-value" id="sarsa-avg">0.00</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Naive Avg:</span>
                    <span class="stat-value" id="naive-avg">0.00</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Success Rate:</span>
                    <span class="stat-value" id="success-rate" style="font-size: 0.85em; word-break: break-word; line-height: 1.4;">0%</span>
                </div>
            </div>

            <div class="card">
                <h2>Policy Visualization</h2>
                <div class="policy-buttons-2x2">
                    <button id="viz-q" class="btn-visualize active" data-policy="q">Q-Learning</button>
                    <button id="viz-sarsa" class="btn-visualize" data-policy="sarsa">SARSA</button>
                    <button id="viz-naive" class="btn-visualize" data-policy="naive">Naive</button>
                </div>

                <div style="text-align: center; margin-top: 16px;">
                    <button id="run-policy-btn" class="btn-primary" disabled>‚ñ∂ Run Policy</button>
                </div>
                <p style="margin: 12px 0 0 0; color: var(--color-text-secondary); font-size: 0.9em; text-align: center;">
                    Viewing: <strong id="current-policy" style="color: var(--color-primary);">Q-Learning</strong>
                </p>
            </div>
        </div>

        <div class="grid-section">
            <h3 class="grid-title">üéÆ Gridworld Environment</h3>
            <div id="grid-container"></div>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" 
                        style="background: linear-gradient(135deg, #22c55e, #16a34a);">
                    </div>
                    <span>Start</span>
                </div>

                <div class="legend-item">
                    <div class="legend-color" 
                        style="background: linear-gradient(135deg, #06b6d4, #0891b2);">
                    </div>
                    <span>Goal</span>
                </div>

                <div class="legend-item">
                    <div class="legend-color" 
                        style="background: linear-gradient(135deg, #dc2626, #991b1b);">
                    </div>
                    <span>Holes</span>
                </div>

                <!-- Q-Learning Arrow -->
                <div class="legend-item">
                    <div class="legend-arrow" style="color: var(--color-q-learning);">
                        ‚Üí
                    </div>
                    <span>Q-Learning Arrow</span>
                </div>

                <!-- SARSA Arrow -->
                <div class="legend-item">
                    <div class="legend-arrow" style="color: var(--color-sarsa);">
                        ‚Üí
                    </div>
                    <span>SARSA Arrow</span>
                </div>

                <!-- Naive Arrow -->
                <div class="legend-item">
                    <div class="legend-arrow" style="color: var(--color-naive);">
                        ‚Üí
                    </div>
                    <span>Naive Arrow</span>
                </div>
            </div>

        </div>

        <div class="charts-container">
            <div class="chart-card">
                <h3>AVERAGE REWARD PER 100 EPISODES</h3>
                <canvas id="rewardChart"></canvas>
            </div>
            <div class="chart-card">
                <h3>SUCCESS RATE OVER TIME</h3>
                <canvas id="winRateChart"></canvas>
            </div>
        </div>

        <div class="card" style="margin-top: 24px;">
            <h2> Convergence Analysis</h2>
            <div class="stats-bar" style="justify-content: space-around;">
                <div class="stat-item">
                    <span class="stat-label">Q-Learning Solved At:</span>
                    <span class="stat-value" id="q-conv" style="color: var(--color-primary);">--</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">SARSA Solved At:</span>
                    <span class="stat-value" id="sarsa-conv" style="color: #f97316;">--</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Naive Greedy:</span>
                    <span class="stat-value" id="naive-conv" style="color: #ef4444;">Never</span>
                </div>
            </div>
            <p style="text-align: left; font-size: 0.8rem; color: #94a3b8; margin-top: 10px;">
                * "Solved" means the 100-episode average reward crossed <strong>900</strong>.
            </p>
        </div>

        <div class="explanation-section">
            <h3>Algorithm Comparison & Expected Behavior</h3>
            
            <div class="explanation-item">
                <strong> Q-Learning (Off-Policy) - THE DAREDEVIL</strong>
                <p><strong>What it does:</strong> Learns the MATHEMATICALLY OPTIMAL path, assuming it will stop making random mistakes in the future.</p>
                <p><strong>Update rule:</strong> Q(s,a) ‚Üê Q(s,a) + Œ±[r + Œ≥¬∑<strong>max(Q(s',¬∑))</strong> - Q(s,a)]</p>
                <p><strong>Behavior:</strong> It tries to walk exactly along the edge of the holes (shortest path). Because of random exploration during training, it often falls in! This lowers its training score, even though it learns the best path.</p>
            </div>

            <div class="explanation-item">
                <strong> SARSA (On-Policy) - THE SAFE PLAYER</strong>
                <p><strong>What it does:</strong> Learns the best policy *given* that it is currently exploring and might make mistakes.</p>
                <p><strong>Update rule:</strong> Q(s,a) ‚Üê Q(s,a) + Œ±[r + Œ≥¬∑<strong>Q(s',a')</strong> - Q(s,a)] (uses ACTUAL next action)</p>
                <p><strong>Behavior:</strong> It realizes "I am clumsy right now, so I should stay away from the edge." It learns a <strong>safer, longer path</strong>. This results in fewer deaths and a HIGHER average reward during training.</p>
            </div>

            <div class="explanation-item">
                <strong> Naive Greedy (UNTRAINED) - BASELINE FAILURE</strong>
                <p><strong>What it does:</strong> PURE EXPLOITATION with ZERO exploration. Q-table starts at 0, so when choosing action: all Q-values = 0, picks randomly forever!</p>
                <p><strong>Why it fails:</strong> No learning = all actions look equally good = random walk = gets stuck in loops = almost never finds goal.</p>
            </div>

            <div class="explanation-item" style="background: rgba(0, 217, 255, 0.1); padding: 12px; border-radius: 8px; border-left: 4px solid var(--color-primary); margin-bottom: 12px;">
                <strong> INTERESTING OBSERVATION:</strong>
                <p>If <strong>SARSA (Orange)</strong> has a higher reward line than <strong>Q-Learning (Blue)</strong>, DON'T THINK it is a bug! This is the famous <strong>"Cliff Walking"</strong> phenomenon.</p>
                <p>SARSA earns more points during training by playing it safe. Q-Learning takes risks to find the shortest path, sacrificing training points for optimality.</p>
            </div>

            <div class="explanation-item" style="background: rgba(0, 217, 255, 0.1); padding: 12px; border-radius: 8px; border-left: 4px solid var(--color-primary);">
                <strong> HOW TO READ THE CHARTS:</strong>
                <p><strong>Left chart (Reward):</strong> Higher is better. Q-Learning and SARSA should climb towards <strong>~950-980</strong> (Max Reward 1000 minus step costs). Naive stays negative (never finds goal).</p>
                <p><strong>Right chart (Success Rate):</strong> Measures how often they reach the goal. Both algorithms should reach near <strong>100%</strong> success once training finishes.</p>
            </div>
        </div>

    <script src="script.js"></script>
</body>
</html>